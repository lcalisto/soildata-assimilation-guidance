
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Cookbook for a masterclass on Soil Data Assimilation">
      
      
        <meta name="author" content="Wageningen Environmental Research">
      
      
        <link rel="canonical" href="https://ejpsoil.github.io/soildata-assimilation-guidance/tools/mapserver/">
      
      
      
      <link rel="icon" href="https://cdn.au.dk/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.3">
    
    
      
        <title>Mapserver - Soil Data Assimilation Guidance</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6b71719e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mapserver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://ejpsoil.eu/" title="Soil Data Assimilation Guidance" class="md-header__button md-logo" aria-label="Soil Data Assimilation Guidance" data-md-component="logo">
      
  <img src="https://ejpsoil.eu/fileadmin/projects/ejpsoil/EJP_Soil_logo_cmyk-h100.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Soil Data Assimilation Guidance
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mapserver
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ejpsoil/soildata-assimilation-guidance" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ejpsoil.eu/" title="Soil Data Assimilation Guidance" class="md-nav__button md-logo" aria-label="Soil Data Assimilation Guidance" data-md-component="logo">
      
  <img src="https://ejpsoil.eu/fileadmin/projects/ejpsoil/EJP_Soil_logo_cmyk-h100.png" alt="logo">

    </a>
    Soil Data Assimilation Guidance
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ejpsoil/soildata-assimilation-guidance" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../identification/" class="md-nav__link">
        Identification
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../etl/" class="md-nav__link">
        Harmonization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../codelists/" class="md-nav__link">
        Code lists
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../metadata/" class="md-nav__link">
        Discovery
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../view/" class="md-nav__link">
        View
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../download/" class="md-nav__link">
        Download
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../QOS/" class="md-nav__link">
        QOS
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-mapserver-mapfile" class="md-nav__link">
    The Mapserver Mapfile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapserver-via-docker" class="md-nav__link">
    Mapserver via Docker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-a-mapfile" class="md-nav__link">
    Testing a mapfile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrb-layer-with-geocat-bridge" class="md-nav__link">
    WRB layer with GeoCat Bridge
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapserver-and-wmts" class="md-nav__link">
    Mapserver and WMTS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-more" class="md-nav__link">
    Read more:
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="mapserver">Mapserver</h1>
<p><em>Status: ready</em></p>
<p>Mapserver, originally <code>UMN Mapserver</code>, is an open source server component which provides OWS services on a variety of data sources.
Mapserver is commonly used to set up INSPIRE View Services. A detailed guidance on how to use Mapserver to set up INSPIRE View Services is available at https://mapserver.org/ogc/inspire.html.</p>
<p>MapServer supports WFS and WCS as data exchange mechanisms. Mapserver is not able to publish datasets having a hierarchical structure, as common in many INSPIRE datasets, which makes MapServer less suitable to provide INSPIRE download Services using WFS. Stored queries are supported. MapServer can be used to set up a WCS Download service.</p>
<p>Mapserver runs as a <a href="https://en.wikipedia.org/wiki/Common_Gateway_Interface">CGI</a> executable. The progream will start up as soon as a request arrives at the server. This makes mapserver very suitable for situations where many datasets are incidentally queried and scales out very well.</p>
<p>Mapserver is configured using <a href="https://www.mapserver.org/mapfile/">map files</a>. These mapfiles contain metadata for each layer, connection details to the datasource and styling rules for the vizualisation. Various tools exist which create mapfiles automatically, from for example a <a href="../bridge-geoserver-geonetwork/">QGIS layer with GeoCat Bridge</a>. Or by using python script, for example with the <a href="https://github.com/geographika/mappyfile">mappyfile</a> library.
The View services relevant for INSPIRE Soil are described in <a href="https://inspire.ec.europa.eu/id/document/tg/so">INSPIRE Data Specification on Soil – Technical Guidelines</a> in <a href="https://github.com/INSPIRE-MIF/technical-guidelines/blob/2022.2/data/so/dataspecification_so.adoc#layers-to-be-provided-by-inspire-view-services">chapter 11</a>. 3 types of layers can be distinguished:
- Soil body, Soil profile and Soil Site are vector datasets indicating the location of research area's.
- Soil properties as vector provide a map view of soil observations on soil profiles or the distribution of a soil property in soil bodies, derived from observations in the area and/or expert judgement.
- Soil properties as coverage, coverage (grid) is a common output of statistical models which calculate the distribution of a soil property.</p>
<h2 id="the-mapserver-mapfile">The Mapserver Mapfile</h2>
<p>For this recipe we'll prepare a WMS view service on a Soil Body dataset. For each Soil Body some derived soil properties of the top soil are available.</p>
<p>Mapserver is configured using <a href="https://www.mapserver.org/mapfile/">map files</a>. These mapfiles contain metadata for each layer, connection details to the datasource and styling rules for the vizualisation. In a typical configuration a user 'calls' the mapserver executable via the web, while indicating the relevant mapfile. For example: </p>
<pre><code>https://example.com/mapserv.cgi?map=/data/soilbody.map&amp;service=WMS&amp;request=GetCapabilities
</code></pre>
<p>Various tools exist which create mapfiles automatically, from for example a QGIS layer. See https://plugins.qgis.org/plugins/geocatbridge/.</p>
<p>In this case we'll assemble the mapfile in a text editor. For some of the more advanced text editors, such as <a href="https://code.visualstudio.com/">Visual Studio Code</a>, mapfile editing plugins are available, which provide validation and syntax highlighting.</p>
<p>A generic mapfile Quick Start is provided at https://live.osgeo.org/en/quickstart/mapserver_quickstart.html. The quickstart is based on <a href="http://live.osgeo.org/">OSGEO Live</a>, a virtual DVD, which offers a preinstalled mapserver and has data from <a href="https://www.naturalearthdata.com/downloads/">Natural Earth</a>. </p>
<p>Within the mapfile, created in the Quickstart, let's replace some metadata and update the natural earth layer to point to our soil body dataset.</p>
<pre><code>MAP
  NAME &quot;SOILBODY_QUICKSTART&quot;
  EXTENT -180 -90 180 90
  UNITS DD
  SHAPEPATH &quot;/home/user/data/&quot;
  SIZE 800 600

  IMAGETYPE PNG24

  PROJECTION
    &quot;init=epsg:4326&quot;
  END

  WEB
    METADATA
      ows_title &quot;Soil Body Quickstart&quot;
      ows_enable_request &quot;*&quot;
      ows_srs &quot;EPSG:4326 EPSG:25832 EPSG:25833&quot;
    END
  END

  LAYER
    NAME &quot;Soilbody&quot;
    STATUS ON
    TYPE POLYGON
    DATA &quot;soilbody&quot;
    CLASS
      STYLE
        COLOR 246 241 223
        OUTLINECOLOR 0 0 0
      END
    END
  END

END
</code></pre>
<h2 id="mapserver-via-docker">Mapserver via Docker</h2>
<p>Mapserver requires a number of dependencies, which may be hard to install on some systems, that's why this recipe suggests to work with Docker containers which are prepared to run mapserver.</p>
<p>The <a href="https://hub.docker.com/r/camptocamp/mapserver">camp2camp mapserver image</a> is a commonly used mapserver container image. While starting the container we provide a number of parameters so the container is able to locate the mapfile and the data files.</p>
<pre><code>docker run -p=80:80 \
    -v=$(PWD)/soilbody.map:/etc/mapserver/wms.map \
    -v=$(PWD)/data:/home/user/data/ \
    camptocamp/mapserver
</code></pre>
<h2 id="testing-a-mapfile">Testing a mapfile</h2>
<p>Sometimes mapserver reports an error while generating a map response.
If the logs of the container do not provide enough information, mapserver provides an interesting utility <a href="https://mapserver.org/utilities/map2img.html">map2img</a> to validate a mapfile. To run the utility, you have to open bash on the container: </p>
<pre><code>docker exec -it &lt;container&gt; /bin/bash 
</code></pre>
<p>and then run the utily:</p>
<pre><code>map2img -m local.map -o test2.png
</code></pre>
<ul>
<li>-m references the mapfile</li>
<li>-o references an output file to be generated</li>
</ul>
<h2 id="wrb-layer-with-geocat-bridge">WRB layer with GeoCat Bridge</h2>
<p>The technical guidance provides quite detailed instructions on how to style the relavant soil layers. For example a SO.SoilBody.WRB is described with dedicated colors for each WRB Soil type.</p>
<table>
<thead>
<tr>
<th>WRB RSG Code</th>
<th>WRB RSG Name</th>
<th>Colour RGB code</th>
<th>Colour HEX code</th>
</tr>
</thead>
<tbody>
<tr>
<td>AC</td>
<td>Acrisol</td>
<td>(247, 152, 4)</td>
<td>#F79804</td>
</tr>
<tr>
<td>AB</td>
<td>Albeluvisol</td>
<td>(254, 194, 194)</td>
<td>#FEC2C2</td>
</tr>
<tr>
<td>AL</td>
<td>Alisol</td>
<td>(255, 255, 190)</td>
<td>#FFFFBE</td>
</tr>
<tr>
<td>..</td>
<td>..</td>
<td>..</td>
<td>..</td>
</tr>
</tbody>
</table>
<p>If many style rules are involved (or if your project already has styling) a tool like GeoCat Bridge is helpfull. Read more about GeoCat Bridge in the <a href="../bridge-geoserver-geonetwork/">recipe Bridge and GeoServer</a>. On QGIS, with the GeoCat Bridge plugin installed, load a SoilBody dataset and assign some of the colors. In the web &gt; bridge menu, activate the Style viewer panel. Notice the various tabs in the panel which represent the layer style in various encodings. The first tab contains <a href="https://www.ogc.org/standards/sld">Styled Layer Descriptor</a> (SLD), a standardised styling format, used for example in GeoServer. The second tab presents the mapfile syntax, you can copy the value into your mapfile (or let Bridge generate a full mapfile).</p>
<p><img alt="Mapfile styler Geocat Bridge" src="../img/bridge-mapfile-styler.png" /></p>
<h2 id="mapserver-and-wmts">Mapserver and WMTS</h2>
<p>Mapserver does not provide tile services (WMTS) itself, but is often combined with a separate tool, <a href="https://mapserver.org/mapcache/">mapcache</a>, which provides tile service on top of a MapServer instance. Tile services are generally a safer option with respect to Quality of Service, but less dynamic in update and styling options. An interesting option is to use the WMS option of Mapcache, which uses a cache of tiles as a source to provide WMS services.</p>
<h2 id="read-more">Read more:</h2>
<ul>
<li>Website: https://mapserver.org</li>
<li>Github: https://github.com/MapServer/MapServer</li>
<li>Docker: https://hub.docker.com/r/camptocamp/mapserver</li>
<li>OSGeo: https://www.osgeo.org/projects/mapserver</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2022-2023 Wageningen Environmental Research
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ba449ae6.min.js"></script>
      
    
  </body>
</html>